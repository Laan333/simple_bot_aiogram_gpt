# Telegram AI Chatbot

Telegram –±–æ—Ç —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π ChatGPT API, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π aiogram 3 –∏ PostgreSQL/SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–æ–≤, —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ª–∏–º–∏—Ç–æ–≤ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ "–±–µ—Å–ø–ª–∞—Ç–Ω–æ–º" —Ä–µ–∂–∏–º–µ.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ `/start` –∏ `/help`
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ChatGPT API (–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å–µ–º–µ–π—Å—Ç–≤–∞ GPT‚Äë4o) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ –≤ Markdown
- ‚úÖ –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ—Ç–≤–µ—Ç –Ω–∞ —Ç–æ–º –∂–µ —è–∑—ã–∫–µ)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –≤ PostgreSQL –∏–ª–∏ SQLite (–ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `.env`)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 5 —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –±–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –°–±—Ä–æ—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/start` –∏–ª–∏ –∫–Ω–æ–ø–∫—É "–ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å"
- ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç: –≤ "–±–µ—Å–ø–ª–∞—Ç–Ω–æ–º" —Ä–µ–∂–∏–º–µ gpt-3.5-turbo ‚Äî –Ω–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞–∑ –≤ 3 –º–∏–Ω—É—Ç—ã (—á–µ—Ä–µ–∑ Redis)
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º aiogram 3 –∏ –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- PostgreSQL 12+ **–∏–ª–∏** SQLite 3 (–≤—Å—Ç—Ä–æ–µ–Ω –≤ Python)
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Redis 6+ ‚Äî –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ "–±–µ—Å–ø–ª–∞—Ç–Ω–æ–º" —Ä–µ–∂–∏–º–µ
- Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É [@BotFather](https://t.me/BotFather))
- OpenAI API Key (–ø–æ–ª—É—á–∏—Ç—å –Ω–∞ [platform.openai.com](https://platform.openai.com/api-keys))

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç**

2. **–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
   ```bash
   python -m venv venv
   ```

3. **–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
   - Windows:
     ```bash
     venv\Scripts\activate
     ```
   - Linux/Mac:
     ```bash
     source venv/bin/activate
     ```

4. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   pip install -r requirements.txt
   ```

5. **–í—ã–±–µ—Ä–∏—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**

   **–í–∞—Ä–∏–∞–Ω—Ç 1: SQLite (–ø—Ä–æ—â–µ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)**
   - –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è: —Ñ–∞–π–ª –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, `db.sqlite3`) –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

   **–í–∞—Ä–∏–∞–Ω—Ç 2: PostgreSQL**
   - –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
     ```sql
     CREATE DATABASE telegram_bot;
     ```
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

6. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env`:
     ```bash
     copy .env.example .env
     ```
   - –û—Ç–∫—Ä–æ–π—Ç–µ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä):
     ```env
     BOT_TOKEN=your_bot_token_here
     OPENAI_API_KEY=your_openai_api_key_here

     # –¢–∏–ø –ë–î: postgresql –∏–ª–∏ sqlite
     DB_TYPE=sqlite

     # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ PostgreSQL (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ PostgreSQL)
     DB_HOST=localhost
     DB_PORT=5432
     DB_NAME=telegram_bot
     DB_USER=postgres
     DB_PASSWORD=postgres

     # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ SQLite (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ SQLite)
     SQLITE_PATH=db.sqlite3

     # –ú–æ–¥–µ–ª—å OpenAI (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: gpt-4o-mini)
     OPENAI_MODEL=gpt-4o-mini

     # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5)
     MAX_CONTEXT_MESSAGES=5

     # –í–∫–ª—é—á–∏—Ç—å "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π" —Ä–µ–∂–∏–º gpt-3.5-turbo —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (true/false)
     FREE_VERSION_GPT=false

     # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) DSN Redis –¥–ª—è rate limiting; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: redis://localhost:6379/0
     REDIS_URL=redis://localhost:6379/0
     ```

## üèÉ –ó–∞–ø—É—Å–∫

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
```bash
python main.py
```

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
telegram-ai-chatbot/
‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ config.py               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ .env.example            # –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ database/               # –ú–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ models.py           # –ú–æ–¥–µ–ª–∏ SQLAlchemy
‚îÇ   ‚îú‚îÄ‚îÄ connection.py       # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ repository.py       # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
‚îú‚îÄ‚îÄ handlers/               # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ commands.py         # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ (/start, /help)
‚îÇ   ‚îî‚îÄ‚îÄ messages.py         # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ keyboards/              # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ inline.py           # Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îî‚îÄ‚îÄ services/               # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ chatgpt.py          # –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å ChatGPT API
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram –ø–æ –∏–º–µ–Ω–∏, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã —É–∫–∞–∑–∞–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —É [@BotFather](https://t.me/BotFather)

2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start` –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã

3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî –±–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ChatGPT –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown

4. –ë–æ—Ç –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 5 —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –±–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start` –∏–ª–∏ –∫–Ω–æ–ø–∫—É "üîÑ –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å" –¥–ª—è —Å–±—Ä–æ—Å–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `.env`:

- `BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `OPENAI_API_KEY` - API –∫–ª—é—á OpenAI
- `OPENAI_MODEL` - –º–æ–¥–µ–ª—å ChatGPT (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `gpt-4o-mini`; –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ª—é–±—É—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—É—é –º–æ–¥–µ–ª—å GPT‚Äë4o/4.1)
- `DB_TYPE` - —Ç–∏–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: `postgresql` –∏–ª–∏ `sqlite` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `postgresql`, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –∏–Ω–æ–µ)
- `DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASSWORD` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PostgreSQL (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –µ—Å–ª–∏ `DB_TYPE=postgresql`)
- `SQLITE_PATH` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É SQLite (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ `DB_TYPE=sqlite`)
- `MAX_CONTEXT_MESSAGES` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5)
- `FREE_VERSION_GPT` - –µ—Å–ª–∏ `true` –∏ –≤—ã–±—Ä–∞–Ω–∞ –º–æ–¥–µ–ª—å `gpt-3.5-turbo`, –≤–∫–ª—é—á–∞–µ—Ç—Å—è "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π" —Ä–µ–∂–∏–º —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º: –Ω–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞–∑ –≤ 3 –º–∏–Ω—É—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `REDIS_URL` - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `redis://localhost:6379/0`)

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `messages` —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

- `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
- `message_text` - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `response_text` - —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞
- `created_at` - –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **aiogram 3** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Telegram –±–æ—Ç–æ–≤
- **PostgreSQL / SQLite** - —Å–∏—Å—Ç–µ–º—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- **SQLAlchemy** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **asyncpg** –∏ **aiosqlite** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã –¥–ª—è PostgreSQL –∏ SQLite
- **Redis** - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ rate limiting –≤ "–±–µ—Å–ø–ª–∞—Ç–Ω–æ–º" —Ä–µ–∂–∏–º–µ
- **OpenAI API** - API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—è–º–∏ —Å–µ–º–µ–π—Å—Ç–≤–∞ GPT‚Äë4o
- **python-dotenv** - –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 5 —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–µ –≤–∫–ª—é—á–∞—è —Ç–µ–∫—É—â–µ–µ)
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—É—Å—Ç
- –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ë–î (PostgreSQL –∏–ª–∏ SQLite) –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏ –±–æ—Ç–∞
- –î–ª—è —Å–±—Ä–æ—Å–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/start` –∏–ª–∏ –∫–Ω–æ–ø–∫—É "–ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å"

## üîÑ Rate limiting –∏ Redis

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –≤–∫–ª—é—á–∏—Ç—å "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π" —Ä–µ–∂–∏–º –¥–ª—è –º–æ–¥–µ–ª–∏ `gpt-3.5-turbo` —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞–∑ –≤ 3 –º–∏–Ω—É—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è), –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ Redis**
   - –ß–µ—Ä–µ–∑ Docker:
     ```bash
     docker run -d --name redis -p 6379:6379 redis:7-alpine
     ```
   - –õ–∏–±–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Redis –ª–æ–∫–∞–ª—å–Ω–æ (Linux/Mac —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä, –Ω–∞ Windows ‚Äî —á–µ—Ä–µ–∑ WSL/Docker).

2. **–í–∫–ª—é—á–∏—Ç–µ "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π" —Ä–µ–∂–∏–º –∏ —É–∫–∞–∂–∏—Ç–µ Redis –≤ `.env`**
   ```env
   OPENAI_MODEL=gpt-3.5-turbo
   FREE_VERSION_GPT=true
   REDIS_URL=redis://localhost:6379/0
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞**
   - –ü—Ä–∏ –∫–∞–∂–¥–æ–º —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ –ò–ò –±–æ—Ç –±—É–¥–µ—Ç –ø–æ–º–µ—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Redis –Ω–∞ 3 –º–∏–Ω—É—Ç—ã.  
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç, –±–æ—Ç –≤–µ—Ä–Ω—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ—Å—Ç–∞–≤—à–∏–º—Å—è –≤—Ä–µ–º–µ–Ω–µ–º –æ–∂–∏–¥–∞–Ω–∏—è.

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ PostgreSQL)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞ (–¥–ª—è PostgreSQL) –∏–ª–∏ —á—Ç–æ –ø—É—Ç—å –∫ SQLite-—Ñ–∞–π–ª—É –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ ChatGPT API
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `OPENAI_API_KEY`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ API –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `BOT_TOKEN`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö.

## üë§ –ê–≤—Ç–æ—Ä

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å aiogram 3, PostgreSQL/SQLite –∏ ChatGPT API.

## üá∫üá∏ English Version

### Telegram AI Chatbot

Telegram bot with ChatGPT API integration, built on aiogram 3 and PostgreSQL/SQLite for storing conversation history, with optional rate limiting for a "free" `gpt-3.5-turbo` mode.

### üöÄ Features

- ‚úÖ Handles `/start` and `/help` commands
- ‚úÖ Integration with ChatGPT (GPT‚Äë4o family models) with Markdown responses
- ‚úÖ Automatic user language detection (answers in the same language)
- ‚úÖ Conversation history stored in PostgreSQL or SQLite (switchable via `.env`)
- ‚úÖ Uses context of the last N messages (configurable, default: 5)
- ‚úÖ Reset context via `/start` command or **"New request"** button
- ‚úÖ Optional rate limiting for "free" `gpt-3.5-turbo` mode: at most **one request per user every 3 minutes** (via Redis)
- ‚úÖ Modern structure based on aiogram 3 and best practices

### üìã Requirements

- Python 3.10+  
- PostgreSQL 12+ **or** SQLite 3 (built into Python)  
- (optional) Redis 6+ ‚Äî for rate limiting in the "free" mode  
- Telegram Bot Token (get it from [@BotFather](https://t.me/BotFather))  
- OpenAI API Key (get it on [platform.openai.com](https://platform.openai.com/api-keys))

### üõ†Ô∏è Setup

```bash
python -m venv venv
venv\Scripts\activate  # Windows
# or
source venv/bin/activate  # Linux/Mac

pip install -r requirements.txt
```

Copy `.env.example` to `.env` and fill in at least:

```env
BOT_TOKEN=your_bot_token_here
OPENAI_API_KEY=your_openai_api_key_here

DB_TYPE=sqlite  # or postgresql
SQLITE_PATH=db.sqlite3

OPENAI_MODEL=gpt-4o-mini
MAX_CONTEXT_MESSAGES=5

FREE_VERSION_GPT=false          # set to true to enable "free" gpt-3.5-turbo mode
REDIS_URL=redis://localhost:6379/0
```

### üèÉ Run

```bash
python main.py
```

The bot will automatically create the required database tables on first run.
